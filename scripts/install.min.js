document.querySelector(".alert__close").addEventListener("click",(e=>{document.querySelector("[role='alert'].alert__block").style.display="none"})),document.querySelector("[data-pass].password-input span").addEventListener("click",(e=>{"icon-eye-c"==e.target.classList.value?(e.target.classList.remove("icon-eye-c"),e.target.classList.add("icon-eye"),document.querySelector("#auth_password").type="password"):(e.target.classList.add("icon-eye-c"),e.target.classList.remove("icon-eye"),document.querySelector("#auth_password").type="string")}));const url="https://micros.uz/it/solutions_our/multicheck.app/app/ajax.php";$("#submit_btn").click((function(e){e.preventDefault();var r={login:$("#auth_login").val(),password:$("#auth_password").val()};$.ajax({url:url,data:r,type:"POST",dataType:"JSON",success:function(e){$("#requestLoader").hide(),e.success?($("#form_login").hide(),document.querySelector("#form_login").style.display="none",document.querySelector("[role='alert'].alert__block").style.display="none",document.querySelector(".other_methods").style.display="none",document.querySelector("#form_install").style.display="block",document.querySelector(".login_form__title").innerHTML="Авторизация прошла успешно!",document.querySelector(".login_form__title").style.textAlign="center",BX24.callMethod("app.option.set",{options:{login:$("#auth_login").val(),password:$("#auth_password").val(),renameCompany:"true"}},(function(e){e.error()&&alert("Описание ошибки: "+e.error())}))):document.querySelector("[role='alert'].alert__block").style.display="block"}}),$("#requestLoader").hide()})),$("#install_btn").click((function(e){e.preventDefault(),$("#installRequestLoader").show(),BX24.init((async function(){BX24.callBind("onCrmContactAdd","https://micros.uz/it/solutions_our/multicheck.app/app/field.type.handler.php",(function(e){e.error()&&(alert("Описание ошибки: "+e.error()),console.error(e.error()))})),BX24.callBind("onCrmCompanyAdd","https://micros.uz/it/solutions_our/multicheck.app/app/field.type.handler.php",(function(e){e.error()&&(alert("Описание ошибки: "+e.error()),console.error(e.error()))}));let e="https://micros.uz/it/solutions_our/multicheck.app/app/field.type.handler.php",r="crm_cpv_type",t="APP_CPV_FIELD";BX24.callMethod("userfieldtype.list",{},(function(o){1==o.data().some((e=>"crm_inn"===e.USER_TYPE_ID))?BX24.callMethod("userfieldtype.update",{USER_TYPE_ID:r,HANDLER:e,TITLE:"multicheck.app.Проверка контрагентов",DESCRIPTION:"Пользовательский тип модуля «multicheck.app.Проверка контрагентов»",OPTIONS:{height:48}},(function(e){e.error()?console.error(e.error()):(BX24.callMethod("crm.company.userfield.add",{fields:{FIELD_NAME:t,VALUE:"000",EDIT_FORM_LABEL:"ИНН (Узбекистан)",LIST_COLUMN_LABEL:"Системное поле модуля",USER_TYPE_ID:r,SHOW_IN_LIST:"Y",XML_ID:t,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля"}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})),BX24.callMethod("crm.deal.userfield.add",{fields:{FIELD_NAME:t,VALUE:"000",EDIT_FORM_LABEL:"ИНН (Узбекистан)",LIST_COLUMN_LABEL:"Системное поле модуля",USER_TYPE_ID:r,SHOW_IN_LIST:"Y",XML_ID:t,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля"}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})),BX24.callMethod("crm.contact.userfield.add",{fields:{FIELD_NAME:t,VALUE:"000",EDIT_FORM_LABEL:"ИНН (Узбекистан)",LIST_COLUMN_LABEL:"Системное поле модуля",USER_TYPE_ID:r,SHOW_IN_LIST:"Y",XML_ID:t,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля"}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})))})):BX24.callMethod("userfieldtype.add",{USER_TYPE_ID:r,HANDLER:e,TITLE:"multicheck.app.Проверка контрагентов",DESCRIPTION:"Пользовательский тип модуля «Проверка контрагента»",OPTIONS:{height:48}},(function(e){e.error()?console.error(e.error()):(BX24.callMethod("crm.company.userfield.add",{fields:{FIELD_NAME:t,VALUE:"000",EDIT_FORM_LABEL:"ИНН (Узбекистан)",LIST_COLUMN_LABEL:"ИНН (Узбекистан)",USER_TYPE_ID:r,SHOW_IN_LIST:"Y",XML_ID:t,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля"}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})),BX24.callMethod("crm.deal.userfield.add",{fields:{FIELD_NAME:t,VALUE:"000",EDIT_FORM_LABEL:"ИНН (Узбекистан)",LIST_COLUMN_LABEL:"ИНН (Узбекистан)",USER_TYPE_ID:r,SHOW_IN_LIST:"Y",XML_ID:t,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля"}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})),BX24.callMethod("crm.contact.userfield.add",{fields:{FIELD_NAME:t,VALUE:"000",EDIT_FORM_LABEL:"ИНН (Узбекистан)",LIST_COLUMN_LABEL:"ИНН (Узбекистан)",USER_TYPE_ID:r,SHOW_IN_LIST:"Y",XML_ID:t,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля"}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})))}))})),BX24.callMethod("crm.requisite.userfield.list",{order:{SORT:"ASC"}},(function(e){if(e.error())console.error(e.error());else{let r=e.answer.result;0==r.some((e=>"UF_CRM_RQ_PHONE"===e.FIELD_NAME))&&BX24.callMethod("crm.requisite.userfield.add",{fields:{ENTITY_ID:"CRM_REQUISITE",FIELD_NAME:"RQ_PHONE",EDIT_FORM_LABEL:"Телефон",USER_TYPE_ID:"string",XML_ID:"RQ_PHONE",SORT:"700",SETTINGS:{}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())})),0==r.some((e=>"UF_CRM_RQ_PINFL"===e.FIELD_NAME))&&BX24.callMethod("crm.requisite.userfield.add",{fields:{ENTITY_ID:"CRM_REQUISITE",FIELD_NAME:"RQ_PINFL",EDIT_FORM_LABEL:"Введите ПИНФЛ",USER_TYPE_ID:"string",XML_ID:"RQ_PINFL",SORT:"750",SETTINGS:{}}},(function(e){e.error()?console.error(e.error()):console.dir(e.data())}))}})),await async function(){try{if(await new Promise(((e,r)=>{BX24.callMethod("crm.requisite.preset.list",{filter:{NAME:"физ. лицо Узбекистан",XML_ID:"APP_ENTITY_PRESET"}},(function(r){r.error()?console.log(result.error()):0==r.data().length?BX24.callMethod("crm.requisite.preset.add",{fields:{ENTITY_TYPE_ID:8,COUNTRY_ID:1,NAME:"Физ. лицо Узбекистан",XML_ID:"APP_ENTITY_PRESET",ACTIVE:"Y",SORT:700}},(function(r){if(r.error())console.error(r);else{function t(e,r){return new Promise(((t,o)=>{BX24.callMethod("crm.requisite.preset.field.add",{preset:{ID:r},fields:{FIELD_NAME:e.name,FIELD_TITLE:e.title,IN_SHORT_LIST:"N",SORT:e.sort}},(function(e){e.error()?o(e.error()):t(e.data())}))}))}r.answer.result,e(async function(e,r){for(let o of e)try{await t(o,r)}catch(e){console.error("Ошибка при добавлении поля",e)}return!0}([{name:"RQ_LAST_NAME",title:"Фамилия",sort:"10"},{name:"RQ_FIRST_NAME",title:"Имя",sort:"20"},{name:"RQ_SECOND_NAME",title:"Отчество",sort:"30"},{name:"UF_CRM_RQ_PINFL",title:"ИНН",sort:"40"}],r.answer.result))}})):e(!0)}))}))){if(await new Promise(((e,r)=>{BX24.callMethod("crm.requisite.preset.list",{filter:{NAME:"Юр. лицо Узбекистан",XML_ID:"APP_ENTITY_PRESET"}},(function(r){r.error()?console.log(result.error()):0==r.data().length?BX24.callMethod("crm.requisite.preset.add",{fields:{ENTITY_TYPE_ID:8,COUNTRY_ID:1,NAME:"Юр. лицо Узбекистан",XML_ID:"APP_ENTITY_PRESET",ACTIVE:"Y",SORT:600}},(function(r){if(r.error())console.error(r.error());else{let o=r.answer.result;function t(e,r){return new Promise(((t,o)=>{BX24.callMethod("crm.requisite.preset.field.add",{preset:{ID:r},fields:{FIELD_NAME:e.name,FIELD_TITLE:e.title,IN_SHORT_LIST:"N",SORT:e.sort}},(function(e){e.error()?o(e.error()):t(e.data())}))}))}e(async function(e,r){for(let o of e)try{await t(o,r)}catch(e){console.error("Ошибка при добавлении поля",e)}return!0}([{name:"RQ_COMPANY_NAME",title:"\tСокращенное наименование организации",sort:"10"},{name:"RQ_COMPANY_FULL_NAME",title:"Полное наименование организации",sort:"20"},{name:"RQ_INN",title:"ИНН",sort:"30"},{name:"RQ_ADDR",title:"Адрес",sort:"40"},{name:"RQ_ACCOUNTANT",title:"Гл. бухгалтер",sort:"50"},{name:"RQ_DIRECTOR",title:"Ген. директор",sort:"60"},{name:"RQ_PHONE",title:"Телефон",sort:"70"},{name:"RQ_OKVED",title:"ОКЭД",sort:"80"}],o))}})):e(!0)}))})))return!0}}catch(e){console.error("Ошибка при добавлении шаблона",e)}}()&&BX24.installFinish()}))}));