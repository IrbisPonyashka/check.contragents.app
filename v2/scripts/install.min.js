document.querySelector(".alert__close").addEventListener("click",(e=>{document.querySelector("[role='alert'].alert__block").style.display="none"})),document.querySelector("[data-pass].password-input span").addEventListener("click",(e=>{"icon-eye-c"==e.target.classList.value?(e.target.classList.remove("icon-eye-c"),e.target.classList.add("icon-eye"),document.querySelector("#auth_password").type="password"):(e.target.classList.add("icon-eye-c"),e.target.classList.remove("icon-eye"),document.querySelector("#auth_password").type="string")})),document.querySelector("#submit_btn").addEventListener("click",(e=>{if(e.preventDefault(),""!==document.querySelector("input#auth_login").value&&""!==document.querySelector("input#auth_password").value){var t=new FormData;t.append("grant_type","password"),t.append("client_id","8"),t.append("client_secret","kV6eVfCQ1u1iVR6Def4K5mMQc9M1NG5t9PS4K1IJ"),t.append("scope",""),t.append("username",document.querySelector("input#auth_login").value),t.append("password",document.querySelector("input#auth_password").value),fetch("https://auth.multibank.uz/oauth/token",{method:"POST",body:t,redirect:"follow"}).then((e=>e.text())).then((e=>{JSON.parse(e).error?(document.querySelector("[role='alert'] .alert__text").innerText="Неправильный логин или пароль.",document.querySelector("[role='alert'].alert__block").style.display="flex"):(document.querySelector("#form_login").style.display="none",document.querySelector("[role='alert'].alert__block").style.display="none",document.querySelector(".other_methods").style.display="none",document.querySelector("#form_install").style.display="block",document.querySelector(".login_form__title").innerHTML="Авторизация прошла успешно!",document.querySelector(".login_form__title").style.textAlign="center",BX24.callMethod("crm.requisite.preset.list",{},(e=>{e.error()?console.error(e.data()):BX24.callMethod("app.option.set",{options:{login:document.querySelector("input#auth_login").value,password:document.querySelector("input#auth_password").value,params:{renameCompany:"true",renameContact:"true",EntityPresetId:e.data()[0].ID,IndividaulPresetId:e.data()[1].ID}}},(e=>{e.error()&&console.error(e.error())}))})))})).catch((e=>console.log("error",e)))}else document.querySelector("[role='alert'] .alert__text").innerText="Введите авторизационные данные, пожалуйста!",document.querySelector("[role='alert'].alert__block").style.display="flex"})),document.querySelector("#install_btn").addEventListener("click",(e=>{e.preventDefault(),BX24.init((async function(){const e="https://micros.uz/it/solutions_our/multicheck.app/v2/app/app.field.php",t="app_multicheck_contragents",r="MULTICHECK_SEARCH";BX24.callMethod("userfieldtype.list",{},(function(l){BX24.callMethod("userfieldtype.list",{},(function(l){1==l.data().some((e=>"crm_cpv_type"===e.USER_TYPE_ID))?(console.log("true",l.data()),BX24.callMethod("userfieldtype.update",{USER_TYPE_ID:"crm_cpv_type",HANDLER:e,TITLE:"multicheck.Проверка контрагентов",DESCRIPTION:"Пользовательский тип поля модуля multicheck.Проверка контрагентов",OPTIONS:{height:48}},(e=>{e.error()?console.error(e.error()):BX24.installFinish()}))):1==l.data().some((e=>"app_multicheck_contragents"===e.USER_TYPE_ID))?BX24.callBatch({userfield_company:{method:"crm.company.userfield.add",params:{fields:{FIELD_NAME:r,VALUE:"",EDIT_FORM_LABEL:"ИНН || ПИНФЛ (Узбекистан)",LIST_COLUMN_LABEL:"ИНН || ПИНФЛ (Узбекистан)",USER_TYPE_ID:t,SHOW_IN_LIST:"Y",XML_ID:r,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля multicheck.Проверка контрагентов "}}}},userfield_contact:{method:"crm.contact.userfield.add",params:{fields:{FIELD_NAME:r,VALUE:"",EDIT_FORM_LABEL:"ИНН || ПИНФЛ (Узбекистан)",LIST_COLUMN_LABEL:"ИНН || ПИНФЛ (Узбекистан)",USER_TYPE_ID:t,SHOW_IN_LIST:"Y",XML_ID:r,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля multicheck.Проверка контрагентов "}}}},userfield_deal:{method:"crm.deal.userfield.add",params:{fields:{FIELD_NAME:r,VALUE:"",EDIT_FORM_LABEL:"ИНН || ПИНФЛ (Узбекистан)",LIST_COLUMN_LABEL:"ИНН || ПИНФЛ (Узбекистан)",USER_TYPE_ID:t,SHOW_IN_LIST:"Y",XML_ID:r,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля multicheck.Проверка контрагентов "}}}}},(e=>{BX24.installFinish()})):BX24.callMethod("userfieldtype.add",{USER_TYPE_ID:t,HANDLER:e,TITLE:"multicheck.Проверка контрагентов",DESCRIPTION:"Пользовательский тип поля модуля multicheck.Проверка контрагентов",OPTIONS:{height:48}},(e=>{e.error()?console.error(e.error()):BX24.callBatch({userfield_company:{method:"crm.company.userfield.add",params:{fields:{FIELD_NAME:r,VALUE:"",EDIT_FORM_LABEL:"ИНН || ПИНФЛ (Узбекистан)",LIST_COLUMN_LABEL:"ИНН || ПИНФЛ (Узбекистан)",USER_TYPE_ID:t,SHOW_IN_LIST:"Y",XML_ID:r,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля multicheck.Проверка контрагентов "}}}},userfield_contact:{method:"crm.contact.userfield.add",params:{fields:{FIELD_NAME:r,VALUE:"",EDIT_FORM_LABEL:"ИНН || ПИНФЛ (Узбекистан)",LIST_COLUMN_LABEL:"ИНН || ПИНФЛ (Узбекистан)",USER_TYPE_ID:t,SHOW_IN_LIST:"Y",XML_ID:r,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля multicheck.Проверка контрагентов "}}}},userfield_deal:{method:"crm.deal.userfield.add",params:{fields:{FIELD_NAME:r,VALUE:"",EDIT_FORM_LABEL:"ИНН || ПИНФЛ (Узбекистан)",LIST_COLUMN_LABEL:"ИНН || ПИНФЛ (Узбекистан)",USER_TYPE_ID:t,SHOW_IN_LIST:"Y",XML_ID:r,SETTINGS:{DEFAULT_VALUE:"Системное поле модуля multicheck.Проверка контрагентов "}}}}},(e=>{BX24.installFinish()}))}))}))}))}))}));